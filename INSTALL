/usr/lib64/openmpi/bin/mpicc -o test test.c

gcc -Wall -o test -I/usr/include/openmpi-x86_64/ -I/usr/lib64/openmpi/ test.c

mpirun -np 1 rng_master : -np 4 rng_client
mpirun localhost -np 1 rng_master : localhost -np 4 rng_client
mpirun --map-by core ./test
mpirun -npernode 4 ./test


mpirun -np 2 bin/queue_tester_rand_computation -d 10 -q 4 -l true --q1-ratio=9 --q2-ratio=8 --q3-ratio=7 --q4-ratio=12 --local-threshold-type=dynamic --local-balance-type=all

free && sync && echo 3 > /proc/sys/vm/drop_caches && free
earlyoom -i -m 40 -s 100

mpirun -np 4 bin/queue_tester_rand_computation -d 30 -q 4 -p 4 -c 4 -l false --local-balance-type=pair -s 5000000

bin/queue_tester_rand_computation -d 30 -q 4 -p 4 -c 4 -l false --local-balance-type=pair -s 15000000
bin/queue_tester_rand_computation_debug -d 100 -q 4 -p 4 -c 1 -l false --local-balance-type=pair -s 20000000

valgrind --leak-check=full --show-leak-kinds=all bin/queue_tester_rand_computation -d 10 -q 4 -p 4 -c 4 -l false --local-balance-type=pair -s 5000000

--trace-children=<yes
--free-fill=<hexnumber>

mpirun -np 4 valgrind --leak-check=full --show-leak-kinds=all bin/queue_tester_rand_computation -d 6 -q 4 -p 4 -c 4 -l false --local-balance-type=pair -s 5000000

cat *rm*28594 > x_rm; sort x_rm > x_rm_s1
cat *rm*28595 > x_rm; sort x_rm > x_rm_s2
cat *rm*28596 > x_rm; sort x_rm > x_rm_s3
cat *rm*28597 > x_rm; sort x_rm > x_rm_s4
cat *ins*28594 > x_ins; sort x_ins > x_ins_s1
cat *ins*28595 > x_ins; sort x_ins > x_ins_s2
cat *ins*28596 > x_ins; sort x_ins > x_ins_s3
cat *ins*28597 > x_ins; sort x_ins > x_ins_s4
diff x_rm_s x_ins_s


set var debug_wait=1
cont


_int_malloc
malloc_consolidate


==18115== Invalid free() / delete / delete[] / realloc()
==18115==    at 0x4C2AD17: free (in /usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)
==18115==    by 0x4089EC: send_data (distributed_queue.c:3048)
==18115==    by 0x40A4F2: comm_listener_global_balance (distributed_queue.c:2838)
==18115==    by 0x5BB9DC4: start_thread (in /usr/lib64/libpthread-2.17.so)
==18115==    by 0x5EC428C: clone (in /usr/lib64/libc-2.17.so)
==18115==  Address 0x17b6f900 is 0 bytes inside a block of size 8 free'd
==18115==    at 0x4C2AD17: free (in /usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)
==18115==    by 0x40891C: send_data (distributed_queue.c:3027)
==18115==    by 0x40A4F2: comm_listener_global_balance (distributed_queue.c:2838)
==18115==    by 0x5BB9DC4: start_thread (in /usr/lib64/libpthread-2.17.so)
==18115==    by 0x5EC428C: clone (in /usr/lib64/libc-2.17.so)